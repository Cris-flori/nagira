
= Nagira configuration

Nagira configured by adjusting settings in +config/defaults.rb+ and
+config/environment.rb+ files. In most cases +defaults.rb+ file should
not be changed, usually only editing +environment.rb+ file is enough.

File +config/defaults.rb+ defines configuration Hash +DEFAULT+, which
is then used to set +settings+ attributes of Sinatra. So,
+config/defaults.rb+ uses Hash assignment syntax to set varibles,
while +config/environment.rb+ file use Sinatra +set <varable>+ syntax.

== Nagios Configuration Files

Location of all Nagios files and data files are automatically detected
by parsing +nagios.cfg+ file on start. Therefore you only need to
point Nagira to that file location. If +Nagira.nagios_cfg+ is +nil+,
Nagira will use value (Dir.glob) defined in
+./lib/ruby-nagios/config/default.rb+ file:

    DEFAULT = { 
      :nagios_cfg_glob => "/etc/nagios*/nagios.cfg"
    }

In most cases you don't need to change configuration in Nagira. If you
are using some standard distribution of Nagios -- for example
RedHat/CentOS RPM or Debian/Ubuntu dpkg -- there are chances, that
your +nagios.cfg+ file is in /etc/nagios3 or /etc/nagios directory. In
this case Nagira will be OK with default configuration.

However, if this is not the case, please set file location as in the
example below.


=== Example configuration

Configure location of main configuration file for production:

    configure :production do
       set :nagios_cfg, "/usr/local/nagios/etc/nagios.cfg"
    end

== Default format

Default output format is defined by +settings.format+ Sinatra
attribute. It is configured in +config/defaults.rb+ as 

    DEFAULT = {
      format: :xml,
      ...}

or in +config/environment.rb+ as 

    set :format, :json

== File parsing time interval

By default Nagios data files are not parsed on each HTTP request,
instead they are parsed only if file was modified more than 60 seconds
ago. This is configured by Sinatra's setting +min_parse_interval+. 

It is set in +config/defaults.rb+ file:

    DEFAULT = {
      min_parse_interval: 60
    }

or +config/environment.rb+ file as:

   set :min_parse_interval, 60

== Verifying your configuration

There is a RSpec file that allows to check your current
configuration. It checks whether your Nagios files exist and can be
parses by the Nagira.

Configurarion checker is environment dependent. To check files for
particular environment run check as:

    RACK_ENV=<environment> rspec -fd spec/00_configuration_spec.rb

In development and test (by default) it will check presence of files
under ./test/data subdirectory. In production it checks actual Nagios
files and validity of files in your Nagios installation.

With no errors check should produce output as following:

  Nagira
    nagios.cfg file
      should exist
      should be parseable
      parsed file
        should have PATH to objects file
        should have PATH to status file
        objects file
          should exist
          should be parseable
        status file
          should exist
          should be parseable

  Finished in 0.1727 seconds
